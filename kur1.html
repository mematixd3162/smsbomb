<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Görev Takip</title>
  <style>
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --danger-color: #ff4d4d;
      --light-bg: #e0f7ff;
      --card-bg: #d9ecff;
      --item-bg: #b3d9ff;
      --task-bg: #e6f2ff;
      --task-item-bg: #cce6ff;
      --done-color: #2e7d32;
      --progress-bg: #e0e0e0;
      --progress-fill: #4caf50;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #cce0ff, #e0f7ff);
      margin: 0;
      padding: 15px;
      min-height: 100vh;
    }
    
    h1 {
      text-align: center;
      color: #003366;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .container {
      max-width: 100%;
      margin: auto;
    }
    
    .input-group {
      display: flex;
      margin-bottom: 15px;
    }
    
    .input-group input {
      flex: 1;
      padding: 12px;
      border: 1px solid #aaa;
      border-radius: 8px 0 0 8px;
      outline: none;
      font-size: 14px;
      min-width: 0; /* Flexbox'ta taşmayı önler */
    }
    
    .input-group button {
      padding: 12px 15px;
      border: none;
      background: var(--primary-color);
      color: white;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      white-space: nowrap;
    }
    
    .input-group button:hover {
      background: var(--primary-hover);
    }
    
    .names-box {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 15px;
      min-height: 150px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }
    
    .name-item {
      background: var(--item-bg);
      margin: 5px 0;
      padding: 10px 40px 10px 10px;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      word-break: break-word;
    }
    
    .delete-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .progress-container {
      margin-top: 8px;
      width: 100%;
      background-color: var(--progress-bg);
      border-radius: 10px;
      overflow: hidden;
      height: 12px;
    }
    
    .progress-bar {
      height: 100%;
      background-color: var(--progress-fill);
      border-radius: 10px;
      transition: width 0.3s ease;
    }
    
    .progress-text {
      font-size: 12px;
      margin-top: 4px;
      text-align: center;
      font-weight: bold;
      color: #003366;
    }
    
    .tasks-box {
      padding: 10px;
      border-radius: 10px;
      min-height: 50px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      background: var(--task-bg);
    }
    
    .task-header {
      background: #99ccff;
      padding: 12px;
      border-radius: 6px;
      margin-top: 8px;
      cursor: pointer;
      font-weight: bold;
      user-select: none;
      transition: 0.2s ease;
      font-size: 0.95rem;
    }
    
    .task-header.done {
      background: var(--done-color) !important;
      color: #fff;
    }
    
    .task-header:hover {
      background: #80bfff;
    }
    
    .task-items {
      display: none;
      margin-left: 5px;
      margin-top: 8px;
      padding-left: 0;
    }
    
    .task-item {
      background: var(--task-item-bg);
      padding: 10px;
      border-radius: 5px;
      margin: 5px 0;
      display: flex;
      align-items: center;
    }
    
    .task-item input {
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    .task-item a {
      color: #003366;
      text-decoration: none;
      word-break: break-all;
    }
    
    .task-item a:hover {
      text-decoration: underline;
    }
    
    /* Mobil için medya sorguları */
    @media (min-width: 768px) {
      .container {
        max-width: 600px;
      }
      
      h1 {
        font-size: 2rem;
      }
    }
    
    @media (max-width: 480px) {
      .input-group {
        flex-direction: column;
      }
      
      .input-group input {
        border-radius: 8px;
        margin-bottom: 8px;
      }
      
      .input-group button {
        border-radius: 8px;
        width: 100%;
      }
      
      .name-item {
        padding: 12px 45px 12px 12px;
      }
      
      .task-header {
        padding: 10px;
        font-size: 0.9rem;
      }
      
      .task-item {
        padding: 8px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <h1>Görev Takip Sistemi</h1>
  <div class="container">
    <div class="input-group">
      <input type="text" id="nameInput" placeholder="İsim ekle...">
      <button onclick="addName()">Ekle</button>
    </div>
    <div class="names-box" id="namesBox"></div>
    <div class="tasks-box" id="tasksBox"></div>
  </div>

  <script>
    const tasksTemplate = [
      { type: "kitap", label: "Kitap Okuma", items: [
        "Gençlik Rehberi",
        "Beş Risale",
        "Paygamberler Tarihi (Asım Köksal)",
        "Düzceli Mehmed",
        "Allah'ım Bana Namaz Kılmayı ve Şükretmeyi Nasip Et"
      ]},
      { type: "video", label: "Video İzleme", items: [
        {name: "Video 1", link: "https://www.youtube.com/watch?v=ijnhdrm0dK0"},
        {name: "Video 2", link: "https://youtu.be/kZNKHdok6Vo?si=iqhxJDlUTBnu60oo"},
        {name: "Video 3", link: "https://youtu.be/JlEBAuVPtC0?si=sXhZ33JeR7jIGyn0"},
        {name: "Video 4", link: "https://youtu.be/EGpsjlj84DM?si=qzXNqdP9QF73EZcJ"},
        {name: "Video 5", link: "https://youtu.be/jCcIcaA5PL0?si=NB_bZ6Vvvt3xpTml"},
        {name: "Video 6", link: "https://youtu.be/ajmOtGaiK6w?si=bL7RS_lw2Wfs9N_c"},
        {name: "Video 7", link: "https://youtu.be/poQa78Xg6BU?si=d9dTTjb7UJILkltm"},
        {name: "Video 8", link: "https://youtu.be/U1TUTsdKVog?si=IN4FghvzrkOvbgbQ"},
        {name: "Video 9", link: "https://youtu.be/r1fcIcmlG6A?si=Txanqc7DDLE1zUwd"},
        {name: "Video 10", link: "https://youtu.be/ZmcJneagHxE?si=wNOELCN1o4F_GAcT"}
      ]},
      { type: "film", label: "Film İzleme", items: [
        {name: "Yunus Emre Bölüm 1", link: "#"},
        {name: "Yunus Emre Bölüm 2", link: "#"},
        {name: "Yunus Emre Bölüm 3", link: "#"},
        {name: "Yunus Emre Bölüm 4", link: "#"},
        {name: "Yunus Emre Bölüm 5", link: "#"},
        {name: "Yunus Emre Bölüm 6", link: "#"},
        {name: "Yunus Emre Bölüm 7", link: "#"},
        {name: "Yunus Emre Bölüm 8", link: "#"},
        {name: "Yunus Emre Bölüm 9", link: "#"},
        {name: "Yunus Emre Bölüm 10", link: "#"}
      ]},
      { type: "ezber", label: "Ezber", items: ["Namaz Sureleri"]},
      { type: "lugat", label: "Lugat", items: ["100"]},
      { type: "mutalaa", label: "Mütalaa Verme", items: [
        "1. söz","2. söz","3. söz","4. söz","5. söz","6. söz","7. söz","8 söz"
      ]},
      { type: "birebir", label: "Birebir Sohbet", items: [
        "Gençlik Rehberi",
        "1 Câzibedar bir fitne içinde bulunan ve daha aklını kaybetmeyen bazı gençlerde bir muhâveredir",
        "2 Bir zaman eskişehir hapishanesinin pencerensinde oturmuştum",
        "3 Birden ihtar edilen bir mes'ele-i mühimme",
        "4 Birkaç bıcare gençlere verilen bir tenbih bir ders ve bir ihtârdır",
        "5 Risâle-i nûr talebeleri tarafından sorulan bir suâle cevab",
        "6 Leyle-i kadir'de ihtâr edilen bir mes'ele-i mühimme",
        "7 Yedinci recâ",
        "8 Altıncı mesele",
        "9 Dokuzuncu şuâ'",
        "10 Hüve nuktesi",
        "11 Siyah dutun bir meyvesi ve gençlik rehberi sonuna kadar",
        "12 Dua"
      ]}
    ];

    let data = JSON.parse(localStorage.getItem("gorevData")) || {};
    let currentName = null;

    function saveData() { localStorage.setItem("gorevData", JSON.stringify(data)); }

    function calculateProgress(name) {
      if (!data[name]) return 0;
      
      let totalTasks = 0;
      let completedTasks = 0;
      
      data[name].forEach(task => {
        task.items.forEach((item, index) => {
          totalTasks++;
          if (task.done && task.done[index]) {
            completedTasks++;
          }
        });
      });
      
      return totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    }

    function addName() {
      const input = document.getElementById("nameInput");
      const name = input.value.trim();
      if(!name) return;
      if(!data[name]){
        data[name] = tasksTemplate.map(t => ({...t, done: t.items.map(i=>false)}));
        saveData();
        renderNames();
      }
      input.value="";
    }

    function deleteName(name){
      if(confirm("'" + name + "' isimli kişiyi silmek istediğinize emin misiniz?")) {
        delete data[name];
        if(currentName===name){
          currentName=null;
          document.getElementById("tasksBox").innerHTML="";
        }
        saveData();
        renderNames();
      }
    }

    function toggleTask(name, taskIndex, itemIndex){
      data[name][taskIndex].done[itemIndex] = !data[name][taskIndex].done[itemIndex];
      saveData();
      renderTasks(name);
      renderNames(); // İsim listesindeki yüzdelikleri güncelle
    }

    function renderNames(){
      const namesBox = document.getElementById("namesBox");
      namesBox.innerHTML="";
      for(let name in data){
        const progress = calculateProgress(name);
        
        const div = document.createElement("div");
        div.className="name-item";
        
        const nameText = document.createElement("div");
        nameText.textContent = name;
        div.appendChild(nameText);
        
        // İlerleme çubuğu
        const progressContainer = document.createElement("div");
        progressContainer.className = "progress-container";
        
        const progressBar = document.createElement("div");
        progressBar.className = "progress-bar";
        progressBar.style.width = `${progress}%`;
        
        const progressText = document.createElement("div");
        progressText.className = "progress-text";
        progressText.textContent = `${progress}% Tamamlandı`;
        
        progressContainer.appendChild(progressBar);
        div.appendChild(progressContainer);
        div.appendChild(progressText);

        const delBtn=document.createElement("button");
        delBtn.textContent="Sil";
        delBtn.className="delete-btn";
        delBtn.onclick=(e)=>{
          e.stopPropagation();
          deleteName(name);
        }
        div.appendChild(delBtn);

        div.addEventListener("click",()=>{
          currentName=name;
          renderTasks(name);
        });

        namesBox.appendChild(div);
      }
    }

    function renderTasks(name){
      const tasksBox = document.getElementById("tasksBox");

      // Önceki açık/kapalı durumları sakla
      const prevOpen = Array.from(tasksBox.querySelectorAll('.task-items'))
        .map(el => getComputedStyle(el).display !== 'none');

      tasksBox.innerHTML="";

      data[name].forEach((taskObj, tIndex)=>{
        const header = document.createElement("div");
        header.className="task-header";
        
        // Görev başlığına yüzdelik ekle
        const taskProgress = calculateTaskProgress(taskObj);
        header.textContent = `${taskObj.label} (${taskProgress}%)`;

        if (Array.isArray(taskObj.done) && taskObj.done.length && taskObj.done.every(Boolean)) {
          header.classList.add("done");
        } else {
          header.classList.remove("done");
        }

        const itemsContainer = document.createElement("div");
        itemsContainer.className="task-items";

        // Önceki durumu uygula
        if (prevOpen[tIndex]) {
          itemsContainer.style.display = "block";
        } else {
          itemsContainer.style.display = "none";
        }

        taskObj.items.forEach((item,i)=>{
          const itemDiv=document.createElement("label");
          itemDiv.className="task-item";

          const checkbox=document.createElement("input");
          checkbox.type="checkbox";
          checkbox.checked=taskObj.done[i];

          checkbox.addEventListener("click", e => e.stopPropagation());
          checkbox.addEventListener("change",(e)=>{
            e.stopPropagation();
            toggleTask(name,tIndex,i);
          });

          const span=document.createElement("span");
          if(typeof item==="string") {
            span.textContent=item;
          } else {
            const link=document.createElement("a");
            link.href=item.link;
            link.target="_blank";
            link.textContent=item.name;
            link.addEventListener("click", e => e.stopPropagation());
            span.appendChild(link);
          }

          itemDiv.appendChild(checkbox);
          itemDiv.appendChild(span);
          itemsContainer.appendChild(itemDiv);
        });

        header.addEventListener("click",()=>{
          itemsContainer.style.display = itemsContainer.style.display === "none" ? "block" : "none";
        });

        tasksBox.appendChild(header);
        tasksBox.appendChild(itemsContainer);
      });
    }

    function calculateTaskProgress(taskObj) {
      if (!taskObj.done || !taskObj.items) return 0;
      
      const totalItems = taskObj.items.length;
      const completedItems = taskObj.done.filter(Boolean).length;
      
      return totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
    }

    // Sayfa yüklendiğinde isimleri render et
    document.addEventListener('DOMContentLoaded', renderNames);
    
    // Enter tuşu ile isim ekleme
    document.getElementById('nameInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        addName();
      }
    });
  </script>
</body>
</html>
